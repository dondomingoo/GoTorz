# Stage 1: Build
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

# Copy solution and restore dependencies
COPY *.sln .
COPY GoTorz.Client/GoTorz.Client.csproj GoTorz.Client/
RUN dotnet restore

# Copy everything and build
COPY GoTorz.Client/ GoTorz.Client/
WORKDIR /src/GoTorz.Client
RUN dotnet publish -c Release -o /app/publish

# Stage 2: Runtime
FROM nginx:stable-alpine AS runtime
WORKDIR /usr/share/nginx/html

# Remove default nginx files
RUN rm -rf ./*

# Copy Blazor build artifacts
COPY --from=build /app/publish/wwwroot .

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
